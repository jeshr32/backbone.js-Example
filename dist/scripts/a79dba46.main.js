function onChangePanels(a,b){$("#listado").html("<table border='1' ><tr><td>Id</td><td>Nombre</td><td>Apellido</td><td>Usuario</td><td>Password</td></tr>");new UsuarioView({el:$("#listado table"),collection:b})}function actualizaPaneles(){usuarios.fetch({success:function(){}})}function onInit(){var a=Backbone.Collection.extend({url:"http://localhost:3000/usuario",model:Usuario});usuarios=new a([]),actualizaPaneles(),usuarios.on({add:onChangePanels,remove:onChangePanels}),$("#sForm").removeAttr("hidden"),$("#del_button").removeAttr("hidden"),$("#set_button").removeAttr("hidden"),formView&&formView.undelegateEvents()}function onForm(){formView=new FormView({el:$("#listado")}),$("#sForm").attr("hidden","true"),$("#del_button").attr("hidden","true"),$("#set_button").attr("hidden","true")}function onUpdate(a){actualizaPaneles(),formView=new FormView({el:$("#listado"),id:a,collection:usuarios}),$("#sForm").attr("hidden","true"),$("#del_button").attr("hidden","true"),$("#set_button").attr("hidden","true")}var miRouter,usuarios,panelView;$(document).ready(function(){miRouter=new Enrutador,Backbone.history.start()});var Usuario=Backbone.Model.extend({idAttribute:"_id",urlRoot:"http://localhost:3000/usuario",defaults:{nombre:"",apellido:"",usuario:"",password:""},initialize:function(a){}}),buttonView;UsuarioView=Backbone.View.extend({events:{click:"_click"},initialize:function(){this.render()},render:function(){var a=$(this.el);this.collection.each(function(b){var c=_.template($("#boton_template").html()),d=c(b.toJSON());a.append(d)}),void 0!=buttonView&&buttonView.undelegateEvents(),buttonView=new ButtonView({el:$("#mini_form")})},_click:function(a){a.preventDefault();var b=$(a.target).data("id"),c=this.collection.get(b);void 0!=c&&($(a.target.parentElement).hasClass("panel_seleccionado")?($.seleccionado=void 0,$(a.target.parentElement).removeClass("panel_seleccionado")):($(a.target.parentElement).addClass("panel_seleccionado"),void 0!=$.seleccionado&&$.seleccionado.removeClass("panel_seleccionado"),$.seleccionado=$(a.target.parentElement)))}}),FormView=Backbone.View.extend({events:{"click #add_button":"agregar","click #close_form_btn":"cerrar"},template:_.template($("#formulario_template").html()),initialize:function(){this.render()},render:function(){if(this.collection)var a=this.collection.get(this.id);else var b=new Usuario({}),a=b;var c=this.template,d=c(a.toJSON());return $(this.$el).html(d),this},agregar:function(a){a.preventDefault();var b=$("#nombre_set").val(),c=$("#apellido_set").val(),d=$("#usuario_set").val(),e=$("#password_set").val();if(this.collection){var f=this.id,g=this.collection.get(f);g.set("nombre",b),g.set("apellido",c),g.set("usuario",d),g.set("password",e),g.save({},{success:function(a,b,c){console.log(b),miRouter.navigate("",{trigger:!0,replace:!0})},error:function(a,b,c){console.log("An error occured while saving the data...")}})}else{var d=new Usuario({nombre:b,apellido:c,usuario:d,password:e});d.save({},{wait:!0,success:function(a,b,c){miRouter.navigate("",{trigger:!0,replace:!0})},error:function(a,b,c){console.debug(a),console.debug(b)}})}},cerrar:function(){miRouter.navigate("",{trigger:!0,replace:!0})}}),ButtonView=Backbone.View.extend({template:_.template($("#buttons_template").html()),events:{"click #sForm":"form","click #del_button":"delete","click #set_button":"update"},initialize:function(){this.render()},render:function(){return $(this.$el).html(this.template),this},form:function(){miRouter.navigate("form",{trigger:!0,replace:!0})},"delete":function(){var a=$(".panel_seleccionado").data("id");void 0!=a&&usuarios.get(a).destroy({wait:!0,success:function(a,b,c){console.log("Usuario eliminado: "+b.result)},error:function(a,b,c){console.log("An error occured while saving the data..."),console.debug(b)}})},update:function(){var a=$(".panel_seleccionado").data("id");void 0!=a&&miRouter.navigate("form/"+a,{trigger:!0,replace:!0})}});var formView;Enrutador=Backbone.Router.extend({routes:{"":"index",form:"formIng","form/:_id":"formAct"},initialize:function(){console.log("Aplicando enrutador")},index:onInit,formIng:onForm,formAct:onUpdate}),this.JST=this.JST||{};